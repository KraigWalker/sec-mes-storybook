<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
		<meta http-equiv="expires" content="0">
		<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />		
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <script src="//assets.adobedtm.com/6677ad16b0484ad2b930d0b209e41c1e96798d52/satelliteLib-0b518e76cb70a8d49d37f81f2983c22dad7c11ff-staging.js"></script>
    <title>Secure Messaging</title>
</head>
<body>
  <div id="app"></div>
  <script>
    // TODO: this is messy. Need to rationalise the baseUrl in a better way
    var myDocuments = document.URL.lastIndexOf('my-documents') > 0 ? true : false;
    var path = document.URL.substr(0,document.URL.lastIndexOf(myDocuments ? 'my-documents' : 'securemessages'));
    window.pathValue = path;
    window.baseURl = window.location.pathname.substr(0, window.location.pathname.lastIndexOf(myDocuments ? '/my-documents' : '/securemessages'))

    var element = document.createElement('script');
    element.src = path + 'main.bundle.js';
    document.body.appendChild(element);
    
    </script>
    <script type="text/javascript">

      function throttle(fn, wait) {
        var time = Date.now();
        return function() {
          if (time + wait - Date.now() < 0) {
            fn();
            time = Date.now();
          }
        }
      }

      //Ensure parent APP using iframe resizes the iframe to accommodate changes in height
      if (window.parent) {
        (function resizeAtInterval() {
          var lastvalue = undefined
          setInterval(function() {
              var height = document.body.scrollHeight;
              if (height !== lastvalue) {
                window.top.postMessage(height, "*");
                lastvalue = height;
              }
          }, 200)}        
        )();

        function resizeParentIframe() {
            window.top.postMessage(document.body.scrollHeight, "*");
        }
        window.onresize = throttle(resizeParentIframe, 500);
        window.onload = throttle(resizeParentIframe, 500);
      }
      

      (function () {

        var normalisedBrandId = {
          CB: "CB",
          YB: "YB",
          DYB: "B"
        }
        function parseHash(hash) {
          return hash
            .split("&")
            .map(function(v) {
              return v.split("=")
            })
            .reduce( function(pre, keyValue) {
              var current = {};
              Object.keys(pre).forEach(function (k) {
                current[k] = pre[k]
              });
              var key = keyValue[0];
              var value = keyValue[1];
              current[key] = value;
              return current;
            }, {});
        }
        
        if (window.location.hash)
        {
            var hash = parseHash(window.location.hash.substring(1));
            var head = document.getElementsByTagName('head')[0];
            var element = document.createElement('link');
            element.rel = 'stylesheet';
            element.href = path + "css/app." + normalisedBrandId[hash.brandId].toLowerCase()+ ".css";
            head.appendChild(element);
        }

        if (_satellite !== undefined && _satellite.pageBottom !== undefined) {
          _satellite.pageBottom();
        }
      })();
      
    </script>

  </body>
</html>